<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.24">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-10-17">

<title>Measure theory – john myers, ph.d.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../img/fav.png" rel="icon" type="image/png">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark-e70e373d709ee9d216e9a1aea6657d26.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-ccc6b90b4d1ed2bb7ba759a873171846.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-VWK3RHBGT2"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-VWK3RHBGT2', { 'anonymize_ip': true});
</script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;1,100;1,200;1,300;1,400;1,500;1,600;1,700&amp;family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&amp;family=Nunito:ital,wght@0,200..1000;1,200..1000&amp;display=swap" rel="stylesheet">
<meta name="quarto:status" content="draft">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><div id="quarto-draft-alert" class="alert alert-warning"><i class="bi bi-pencil-square"></i>Draft</div>
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../index.html" class="navbar-brand navbar-brand-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">about</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../writings.html"> 
<span class="menu-text">writings</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-teaching" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">teaching</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-teaching">    
        <li>
    <a class="dropdown-item" href="../../teaching/calculus-ii-fa-25.html">
 <span class="dropdown-text">mat220 calculus II, fall 2025</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../teaching/analysis-fa-25.html">
 <span class="dropdown-text">mat347 analysis, fall 2025</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://www.johnmyers-phd.com/book" target="_blank"> 
<span class="menu-text">probabilistic machine learning</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/jmyers7/" target="_blank"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/in/john-myers-phd" target="_blank"> <i class="bi bi-linkedin" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="mailto:jmmyers25@gmail.com"> <i class="bi bi-envelope-open-fill" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#random-variables-as-information-carriers" id="toc-random-variables-as-information-carriers" class="nav-link" data-scroll-target="#random-variables-as-information-carriers">Random variables as information carriers</a></li>
  <li><a href="#hilbert-spaces-of-random-variables" id="toc-hilbert-spaces-of-random-variables" class="nav-link" data-scroll-target="#hilbert-spaces-of-random-variables">Hilbert spaces of random variables</a></li>
  <li><a href="#conditional-expectations-as-projections" id="toc-conditional-expectations-as-projections" class="nav-link" data-scroll-target="#conditional-expectations-as-projections">Conditional expectations as projections</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">Conclusion</a></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Measure theory</h1>
  <div class="quarto-categories">
    <div class="quarto-category">Information theory</div>
    <div class="quarto-category">Probability theory</div>
    <div class="quarto-category">Measure theory</div>
    <div class="quarto-category">Sigma-algebras</div>
    <div class="quarto-category">Conditional expectations</div>
    <div class="quarto-category">Hilbert spaces</div>
    <div class="quarto-category">Linear algebra</div>
    <div class="quarto-category">R</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 17, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required packages</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"ggplot2"</span>) <span class="co"># For plotting</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"knitr"</span>) <span class="co"># For table formatting (used with kable())</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"dplyr"</span>) <span class="co"># For data manipulation</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"latex2exp"</span>) <span class="co"># For LaTeX rendering in plots</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Source custom theme file</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Replace this path with your own theme file location</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"../../aux-files/custom-theme.R"</span>)</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Extract custom colors from theme</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: These color definitions depend on your custom theme file</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>yellow <span class="ot">&lt;-</span> custom_colors[[<span class="st">"yellow"</span>]]</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>blue <span class="ot">&lt;-</span> custom_colors[[<span class="st">"blue"</span>]]</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply custom ggplot2 theme</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">custom_theme</span>())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="random-variables-as-information-carriers" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="random-variables-as-information-carriers">Random variables as information carriers</h2>
<p>First, we set the scene and recall a few basic concepts from the previous post. We let <span class="math inline">\(\Omega\)</span> be a finite set, conceptualized as the set of outcomes of an experiment. An <em>algebra of sets</em> <span class="math inline">\(\mathcal{F}\)</span> in <span class="math inline">\(\Omega\)</span> is a collection of subsets of <span class="math inline">\(\Omega\)</span> that contains <span class="math inline">\(\Omega\)</span> and is closed under complements and finite unions. Algebras capture information about which events can be observed in the experiment: if <span class="math inline">\(A \in \mathcal{F}\)</span>, then the event <span class="math inline">\(A\)</span> is observable, meaning that an observer can determine whether the outcome <span class="math inline">\(\omega \in A\)</span> or not. Algebras can be partially ordered by the refinement relation: an algebra <span class="math inline">\(\mathcal{F}\)</span> <em>refines</em> another algebra <span class="math inline">\(\mathcal{G}\)</span> if <span class="math inline">\(\mathcal{G}\subset \mathcal{F}\)</span>. In this case, <span class="math inline">\(\mathcal{F}\)</span> contains at least as much information as <span class="math inline">\(\mathcal{G}\)</span>, since every event observable in <span class="math inline">\(\mathcal{G}\)</span> is also observable in <span class="math inline">\(\mathcal{F}\)</span>.</p>
<p>As we will see in this section, functions on <span class="math inline">\(\Omega\)</span> also carry information. In particular, <em>random variables</em> are functions <span class="math inline">\(X:\Omega \to \mathbb{R}\)</span> that assign a real number to each outcome <span class="math inline">\(\omega \in \Omega\)</span>. They induce algebras through their <em>level sets</em>, which are the preimages of singletons in <span class="math inline">\(\mathbb{R}\)</span>. In what follows, it will be convenient to allow the codomain of <span class="math inline">\(X\)</span> to be an arbitrary finite-dimensional euclidean space <span class="math inline">\(\mathbb{R}^n\)</span>, not just <span class="math inline">\(\mathbb{R}\)</span>, in which case a function <span class="math inline">\(X:\Omega \to \mathbb{R}^n\)</span> is often called a <em>random vector</em>.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-rv-part" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 1</strong></span> Let <span class="math inline">\(X:\Omega\to \mathbb{R}^n\)</span> be a random vector on a finite set <span class="math inline">\(\Omega\)</span>. For <span class="math inline">\(x\in \mathbb{R}^n\)</span>, sets of the form</p>
<p><span class="math display">\[
X^{-1}(x) \overset{\text{def}}{=}\{ \omega \in \Omega : X(\omega)=x\}
\]</span></p>
<p>are called <em>level sets</em>.</p>
</div>
</div>
</div>
</div>
<p>As you may easily check, the nonempty level sets of a random vector <span class="math inline">\(X\)</span> partition its domain, and through this partition the random vector generates an algebra of sets in <span class="math inline">\(\Omega\)</span> denoted <span class="math inline">\(\sigma(X)\)</span>. The level sets are the <em>atoms</em> of this algebra, i.e., they are the minimal nonempty sets in <span class="math inline">\(\sigma(X)\)</span>. The algebra <span class="math inline">\(\sigma(X)\)</span> captures precisely the information an observer gains by learning the value of <span class="math inline">\(X\)</span>. If the observer knows <span class="math inline">\(X(\omega) = x\)</span>, they know that <span class="math inline">\(\omega \in X^{-1}(x)\)</span> but cannot distinguish between outcomes within this level set. Thus, <span class="math inline">\(\sigma(X)\)</span> represents the coarsest partition of <span class="math inline">\(\Omega\)</span> consistent with the information provided by <span class="math inline">\(X\)</span>.</p>
<p>For an example, we consider the experiment of flipping a coin three times that we introduced in the <a href="../info-2/">previous post</a>. The sample space is</p>
<p><span class="math display">\[
\Omega = \{000, 001, 010, 011, 100, 101, 110, 111\},
\]</span></p>
<p>where a binary string represents the results of the three flips, with a <span class="math inline">\(0\)</span> representing tails and a <span class="math inline">\(1\)</span> representing heads. We define three random variables</p>
<p><span class="math display">\[
X_1, X_2, X_3:\Omega \to \{0,1\}
\]</span></p>
<p>that record the results of the first, second, and third flips, respectively. For instance, <span class="math inline">\(X_1(010) = 0\)</span> since the first flip in the sequence <span class="math inline">\(010\)</span> is tails. We introduce a fourth random variable</p>
<p><span class="math display">\[
Y:\Omega \to \{0,1,2,3\}
\]</span></p>
<p>that records the total number of heads across all three flips, i.e.,</p>
<p><span class="math display">\[
Y = X_1 + X_2 + X_3.
\]</span></p>
<p>The following data frame displays the sample space <span class="math inline">\(\Omega\)</span> along with the values of the four random variables.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the sample space Omega as a data frame</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Each row represents one of the 8 possible outcomes (binary sequences of length 3)</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">X1 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="co"># First coin flip: 0 = tail, 1 = head</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">X2 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="co"># Second coin flip</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">X3 =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>) <span class="co"># Third coin flip</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Add random variable Y: total number of heads across all three flips</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Y =</span> X1 <span class="sc">+</span> X2 <span class="sc">+</span> X3)</span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the sample space as a formatted table</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  Omega,</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"sample space $</span><span class="sc">\\</span><span class="st">Omega$ with random variables $X_1, X_2, X_3$, and $Y$"</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>sample space <span class="math inline">\(\Omega\)</span> with random variables <span class="math inline">\(X_1, X_2, X_3\)</span>, and <span class="math inline">\(Y\)</span></caption>
<thead>
<tr class="header">
<th style="text-align: right;">X1</th>
<th style="text-align: right;">X2</th>
<th style="text-align: right;">X3</th>
<th style="text-align: right;">Y</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>Notice that the two level sets of <span class="math inline">\(X_1\)</span> are</p>
<p><span class="math display">\[
\begin{align*}
A_1 &amp;= X_1^{-1}(0) = \{000, 001, 010, 011\}, \\
A_2 &amp;= X_1^{-1}(1) = \{100, 101, 110, 111\}.
\end{align*}
\]</span></p>
<p>The reader will note that these are exactly the atoms of the algebra <span class="math inline">\(\mathcal{F}_1\)</span> we considered in the <a href="../info-2/">previous post</a>. Thus, <span class="math inline">\(\sigma(X_1) = \mathcal{F}_1\)</span>.</p>
<p>Similarly, the level sets of <span class="math inline">\(X_2\)</span> and <span class="math inline">\(X_3\)</span> are</p>
<p><span class="math display">\[
\begin{align*}
X_2^{-1}(0) &amp;= \{000, 001, 100, 101\}, &amp; X_2^{-1}(1) &amp;= \{010, 011, 110, 111\}, \\
X_3^{-1}(0) &amp;= \{000, 010, 100, 110\}, &amp; X_3^{-1}(1) &amp;= \{001, 011, 101, 111\}.
\end{align*}
\]</span></p>
<p>If we form all pairwise intersections of the level sets of <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>, we obtain the sets</p>
<p><span class="math display">\[
B_1 = \{000,001\}, \quad B_2 = \{010,011\}, \quad B_3 = \{100,101\}, \quad B_4 = \{110,111\},
\]</span></p>
<p>which were the atoms of the algebra <span class="math inline">\(\mathcal{F}_2\)</span> from the <a href="../info-2/">previous post</a>. In the notation to be introduced below (see <a href="#def-algebra-gen-rv" class="quarto-xref">Definition&nbsp;2</a>), this means that</p>
<p><span class="math display">\[
\sigma(X_1, X_2) = \mathcal{F}_2,
\]</span></p>
<p>or that <span class="math inline">\(\mathcal{F}_2\)</span> is the algebra generated by <span class="math inline">\(X_1\)</span> and <span class="math inline">\(X_2\)</span>. If we form all <span class="math inline">\(3\)</span>-fold intersections of the level sets of <span class="math inline">\(X_1\)</span>, <span class="math inline">\(X_2\)</span>, and <span class="math inline">\(X_3\)</span>, we obtain the singletons</p>
<p><span class="math display">\[
\begin{gather*}
C_1 = \{000\}, \ C_2 = \{001\}, \ C_3 = \{010\}, \ C_4 = \{011\}, \\
C_5 = \{100\}, \ C_6 = \{101\}, \ C_7 = \{110\}, \ C_8 = \{111\},
\end{gather*}
\]</span></p>
<p>which were the atoms of the algebra <span class="math inline">\(\mathcal{F}_3\)</span> from the <a href="../info-2/">previous post</a>. Again, in the notation to be introduced below (see <a href="#def-algebra-gen-rv" class="quarto-xref">Definition&nbsp;2</a>), this means that</p>
<p><span class="math display">\[
\sigma(X_1, X_2, X_3) = \mathcal{F}_3,
\]</span></p>
<p>or that <span class="math inline">\(\mathcal{F}_3\)</span> is the algebra generated by <span class="math inline">\(X_1, X_2,\)</span> and <span class="math inline">\(X_3\)</span>. Thus, the nested sequence of algebras</p>
<p><span class="math display">\[
\mathcal{F}_1 \subset \mathcal{F}_2 \subset \mathcal{F}_3
\]</span></p>
<p>may be rewritten as</p>
<p><span class="math display">\[
\sigma(X_1) \subset \sigma(X_1, X_2) \subset \sigma(X_1, X_2, X_3).
\]</span></p>
<p>Finally, the level sets of <span class="math inline">\(Y\)</span> are</p>
<p><span class="math display">\[
\begin{align*}
D_1 &amp;= Y^{-1}(0) = \{000\}, \\
D_2 &amp;= Y^{-1}(1) = \{001,010,100\}, \\
D_3 &amp;= Y^{-1}(2) = \{011,101,110\}, \\
D_4 &amp;= Y^{-1}(3) = \{111\}.
\end{align*}
\]</span></p>
<p>In the <a href="../info-2/">previous post</a>, we had columns in our data frame indicating which outcomes belonged to which atoms <span class="math inline">\(A_i\)</span>, <span class="math inline">\(B_i\)</span>, and <span class="math inline">\(C_i\)</span>; let’s add these columns here as well, along with columns for the <span class="math inline">\(D_i\)</span>:</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Group outcomes by the result of the first flip (X1)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and assign a group ID to track which partition set (A1 or A2) each outcome belongs to</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X1) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ai =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="co"># Ai = 1 for A1 (X1=0), Ai = 2 for A2 (X1=1)</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Group outcomes by the results of the first two flips (X1 and X2)</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a><span class="co"># and assign a group ID to track which partition set (B1, B2, B3, or B4) each outcome belongs to</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X1, X2) <span class="sc">%&gt;%</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Bi =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="co"># Bi = 1 for B1, Bi = 2 for B2, etc.</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Group outcomes by all three flips (X1, X2, and X3)</span></span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Each combination of (X1, X2, X3) uniquely identifies one outcome</span></span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(X1, X2, X3) <span class="sc">%&gt;%</span></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Ci =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="co"># Ci = 1 for C1, Ci = 2 for C2, etc.</span></span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Y) <span class="sc">%&gt;%</span></span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Di =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="co"># Di = 1 for D1, Di = 2 for D2, etc.</span></span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a><span class="co"># Display a formatted table showing the sample space Omega with random variables X1, X2, X3, and Y, including atoms Ai, Bi, Ci, and Di.</span></span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>  Omega,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>  <span class="at">caption =</span> <span class="st">"sample space $</span><span class="sc">\\</span><span class="st">Omega$ with random variables $X_1, X_2, X_3$, and $Y$, along with atoms $A_i$, $B_i$, $C_i$, and $D_i$"</span></span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption>sample space <span class="math inline">\(\Omega\)</span> with random variables <span class="math inline">\(X_1, X_2, X_3\)</span>, and <span class="math inline">\(Y\)</span>, along with atoms <span class="math inline">\(A_i\)</span>, <span class="math inline">\(B_i\)</span>, <span class="math inline">\(C_i\)</span>, and <span class="math inline">\(D_i\)</span></caption>
<thead>
<tr class="header">
<th style="text-align: right;">X1</th>
<th style="text-align: right;">X2</th>
<th style="text-align: right;">X3</th>
<th style="text-align: right;">Y</th>
<th style="text-align: right;">Ai</th>
<th style="text-align: right;">Bi</th>
<th style="text-align: right;">Ci</th>
<th style="text-align: right;">Di</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">3</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">4</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>We will return to this data frame momentarily, but first we introduce some notation for algebras generated by multiple random vectors. Above, we’ve seen algebras generated by one, two, and three random variables. In fact, we may form algebras generated by any finite number of random variables, as follows.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-algebra-gen-rv" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 2</strong></span> Let <span class="math inline">\(X_1,X_2,\ldots,X_m\)</span> be random vectors on a finite set <span class="math inline">\(\Omega\)</span>. The <em>algebra generated</em> by <span class="math inline">\(X_1,X_2,\ldots,X_m\)</span> is the algebra of sets in <span class="math inline">\(\Omega\)</span>, denoted by <span class="math inline">\(\sigma(X_1,X_2,\ldots,X_m)\)</span>, whose atoms are all nonempty intersections of the form <span class="math display">\[
\bigcap_{i=1}^m X_i^{-1}(x_i),
\]</span></p>
<p>where <span class="math inline">\(x_i\)</span> is a value of <span class="math inline">\(X_i\)</span> for each <span class="math inline">\(i\)</span>.</p>
</div>
</div>
</div>
</div>
<p>In fact, if we are given a finite set of random variables <span class="math inline">\(X_1,X_2,\ldots,X_m\)</span> as in the theorem, then we may form the random vector</p>
<p><span class="math display">\[
X: \Omega \to \mathbb{R}^m, \quad X(\omega) = (X_1(\omega), X_2(\omega), \ldots, X_m(\omega)).
\]</span></p>
<p>Then, as you may easily check, the algebra generated by <span class="math inline">\(X_1,X_2,\ldots,X_m\)</span> is simply the algebra generated by the random vector <span class="math inline">\(X\)</span>:</p>
<p><span class="math display">\[
\sigma(X_1,X_2,\ldots,X_m) = \sigma(X).
\]</span></p>
<p>Now, very often the set <span class="math inline">\(\Omega\)</span> comes equipped with a pre-existing algebra <span class="math inline">\(\mathcal{F}\)</span> of observable events (perhaps as part of a probability space <span class="math inline">\((\Omega,\mathcal{F},P)\)</span>). In this case, it is natural to ask how the information encoded in <span class="math inline">\(\sigma(X)\)</span> relates to that in <span class="math inline">\(\mathcal{F}\)</span>. The first possiblity is that neither algebra refines the other, meaning that <span class="math inline">\(\sigma(X)\)</span> and <span class="math inline">\(\mathcal{F}\)</span> contain different kinds of information. The other possibilities are that one algebra refines the other, meaning that one contains at least as much information as the other. The following theorem characterizes these refinement relations in terms of the behavior of <span class="math inline">\(X\)</span> on the atoms of <span class="math inline">\(\mathcal{F}\)</span>.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-rv-refine" class="theorem">
<p><span class="theorem-title"><strong>Theorem 1 (Random variables and refinements)</strong></span> Let <span class="math inline">\(\mathcal{F}\)</span> be an algebra of sets in a finite set <span class="math inline">\(\Omega\)</span>, and let <span class="math inline">\(X:\Omega \to \mathbb{R}^n\)</span> be a random vector.</p>
<ol type="1">
<li><p>The algebra <span class="math inline">\(\mathcal{F}\)</span> refines <span class="math inline">\(\sigma(X)\)</span> (equivalently, <span class="math inline">\(\sigma(X) \subset \mathcal{F}\)</span>) if and only if <span class="math inline">\(X\)</span> is constant on every atom in <span class="math inline">\(\mathcal{F}\)</span>.</p></li>
<li><p>The algebra <span class="math inline">\(\sigma(X)\)</span> refines <span class="math inline">\(\mathcal{F}\)</span> (equivalently, <span class="math inline">\(\mathcal{F}\subset \sigma(X)\)</span>) if and only if every atom in <span class="math inline">\(\mathcal{F}\)</span> is a union of level sets of <span class="math inline">\(X\)</span>.</p></li>
</ol>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-1-contents" aria-controls="callout-1" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-1" class="callout-1-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The algebra <span class="math inline">\(\mathcal{F}\)</span> refines <span class="math inline">\(\sigma(X)\)</span> if and only if every nonempty level set is a union of atoms in <span class="math inline">\(\mathcal{F}\)</span>. This proves the result in the first statement. A symmetric argument using the same theorem proves the second statement.</p>
</div>
</div>
</div>
<p>Random vectors satisfying the first condition in <a href="#thm-rv-refine" class="quarto-xref">Theorem&nbsp;1</a> arise frequently enough to warrant their own terminology.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-measurable" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 3</strong></span> Let <span class="math inline">\(\mathcal{F}\)</span> be an algebra of sets in a finite set <span class="math inline">\(\Omega\)</span>. A random vector <span class="math inline">\(X\)</span> on <span class="math inline">\(\Omega\)</span> will be called <em><span class="math inline">\(\mathcal{F}\)</span>-measurable</em> if <span class="math inline">\(\mathcal{F}\)</span> refines the algebra <span class="math inline">\(\sigma(X)\)</span>, i.e., <span class="math inline">\(\sigma(X) \subset \mathcal{F}\)</span>.</p>
</div>
</div>
</div>
</div>
<p>Returning to our coin-flipping scenario, we see that <span class="math inline">\(Y\)</span> is <em>only</em> <span class="math inline">\(\mathcal{F}_3\)</span>-measureable, since the atoms in this algebra are the only ones on which <span class="math inline">\(Y\)</span> is constant. (Of course, <span class="math inline">\(\mathcal{F}_3\)</span> is the power set of <span class="math inline">\(\Omega\)</span>.) The information afforded by <span class="math inline">\(Y\)</span> is not comparable to that of <span class="math inline">\(\mathcal{F}_1\)</span> or <span class="math inline">\(\mathcal{F}_2\)</span>, since there are no subset containments between <span class="math inline">\(\sigma(Y)\)</span> and <span class="math inline">\(\mathcal{F}_1\)</span> or <span class="math inline">\(\mathcal{F}_2\)</span>.</p>
<p>If <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> are both random vectors on <span class="math inline">\(\Omega\)</span>, then we may compare the information they encode by comparing their algebras <span class="math inline">\(\sigma(X)\)</span> and <span class="math inline">\(\sigma(Y)\)</span>. Then <a href="#thm-rv-refine" class="quarto-xref">Theorem&nbsp;1</a> tells us <em>when</em> one algebra refines the other, but not <em>how</em> the vectors relate. The next theorem provides this missing piece: refinement is equivalent to functional dependence.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-functional-rep" class="theorem">
<p><span class="theorem-title"><strong>Theorem 2 (Functional representation)</strong></span> Let <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> be two <span class="math inline">\(\mathbb{R}^n\)</span>-valued random vectors on a finite set <span class="math inline">\(\Omega\)</span>. The following statements are equivalent:</p>

<ol type="1">
<li>The algebra <span class="math inline">\(\sigma(Y)\)</span> refines <span class="math inline">\(\sigma(X)\)</span>.</li>
<li>There exists a function <span class="math inline">\(f:\mathbb{R}^n \to \mathbb{R}^n\)</span> such that <span class="math inline">\(X = f \circ Y\)</span>.</li>
</ol>
</div>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-margin-content callout-margin-content-simple">
<p><a href="#thm-functional-rep" class="quarto-xref">Theorem&nbsp;2</a> holds for general measurable spaces, not just finite sets. The proof requires the Doob-Dynkin lemma and properties of <span class="math inline">\(\sigma\)</span>-algebras. See Lemma 1.14 in <span class="citation" data-cites="Kallenberg2021">Kallenberg (<a href="#ref-Kallenberg2021" role="doc-biblioref">2021</a>)</span> for the general statement and proof. Our finite setting allows a more elementary approach.</p>
</div></div><div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-2-contents" aria-controls="callout-2" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-2" class="callout-2-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Suppose that <span class="math inline">\(\sigma(Y)\)</span> refines <span class="math inline">\(\sigma(X)\)</span> and write</p>
<p><span class="math display">\[
X = \sum_{i=1}^m x_i I_{A_i} \quad \text{and} \quad Y = \sum^n_{j=1} y_j I_{B_j},
\]</span></p>
<p>where <span class="math inline">\(I_{A_i}\)</span> and <span class="math inline">\(I_{B_j}\)</span> are indicator functions for the level sets</p>
<p><span class="math display">\[
A_i = X^{-1}(x_i) \quad \text{and} \quad B_j = Y^{-1}(y_j).
\]</span></p>
<p>Then every level set <span class="math inline">\(B_j\)</span> is contained in a unique level set <span class="math inline">\(A_i\)</span>, and we may define a function</p>
<p><span class="math display">\[
h:\{y_1,\ldots,y_n\} \to \mathbb{R}
\]</span></p>
<p>by setting <span class="math inline">\(h(y_j) = x_i\)</span> if <span class="math inline">\(B_j \subset A_i\)</span>. Then, define</p>
<p><span class="math display">\[
\pi: \mathbb{R}\to \mathbb{R}, \quad \pi(y) = \sum_{j=1}^n \delta_{y_j}(y),
\]</span></p>
<p>where <span class="math inline">\(\delta_{y_j}\)</span> is a Dirac delta function. If we then set <span class="math inline">\(f = h \circ \pi\)</span> and choose <span class="math inline">\(\omega\)</span> in an arbitrary <span class="math inline">\(B_j\)</span>, we have</p>
<p><span class="math display">\[
f(Y(\omega)) = (h\circ \pi)(y_j) = h(y_j) = x_i = X(\omega).
\]</span></p>
<p>Since <span class="math inline">\(B_j\)</span> and <span class="math inline">\(\omega\)</span> were chosen arbitrarily, this proves that (1) implies (2).</p>
<p>To prove the converse, suppose that <span class="math inline">\(X = f \circ Y\)</span> for some function <span class="math inline">\(f:\mathbb{R}\to \mathbb{R}\)</span>. To prove that <span class="math inline">\(\sigma(Y)\)</span> refines <span class="math inline">\(\sigma(X)\)</span>, by <a href="#thm-rv-refine" class="quarto-xref">Theorem&nbsp;1</a> it will suffice to show that every level set of <span class="math inline">\(Y\)</span> is contained in a level set of <span class="math inline">\(X\)</span>. So, let <span class="math inline">\(y \in \mathbb{R}\)</span> and consider the level set <span class="math inline">\(B = Y^{-1}(y)\)</span>. If <span class="math inline">\(B\)</span> is nonempty, then for every <span class="math inline">\(\omega \in B\)</span>, we have <span class="math inline">\(X(\omega) = f(Y(\omega)) = f(y)\)</span>. Thus, <span class="math inline">\(B \subset X^{-1}(f(y))\)</span>, and the proof is complete.</p>
</div>
</div>
</div>
<p>Returning again to our coin-flipping example, we see that according to the theorem <span class="math inline">\(Y\)</span> is supposed to be a function of the random vector <span class="math inline">\((X_1, X_2,X_3)\)</span>, since we observed that <span class="math inline">\(\mathcal{F}_3 = \sigma(X_1, X_2, X_3)\)</span> refines <span class="math inline">\(\sigma(Y)\)</span>. Indeed, we <em>defined</em> <span class="math inline">\(Y\)</span> to be a function of this random vector via the equation</p>
<p><span class="math display">\[
Y = X_1 + X_2 + X_3,
\]</span></p>
<p>so <span class="math inline">\(Y = f \circ (X_1,X_2,X_3)\)</span> where <span class="math inline">\(f\)</span> is summation.</p>
</section>
<section id="hilbert-spaces-of-random-variables" class="level2 page-columns page-full">
<h2 class="anchored" data-anchor-id="hilbert-spaces-of-random-variables">Hilbert spaces of random variables</h2>
<p>We’ve seen how random variables encode information through the algebras they generate. But random variables also have numerical values, which allows us to perform algebraic operations: we can add them, multiply them by scalars, and compute their expected values. This algebraic structure becomes particularly rich when we introduce an inner product, turning the space of random variables into a Hilbert space. This latter structure provides a geometric perspective on random variables, where concepts like orthogonality, projection, and distance become meaningful. This perspective will prove essential for understanding conditional expectation, which emerges naturally as orthogonal projection onto subspaces determined by algebras.</p>
<p>First, we recall that the pointwise sum and scalar multiple of random variables are again random variables, and these operations have the usual properties of commutativity, associativity, <em>etc</em>. Thus, the set of all random variables on a finite set <span class="math inline">\(\Omega\)</span> forms a vector space over the real numbers <span class="math inline">\(\mathbb{R}\)</span>. The subspaces of this vector space that are most relevant to us are those consisting of random variables that are measurable with respect to a given algebra of sets.</p>
<p>We shall also need the concept of <em>expectation</em> of a measurable random variable. If <span class="math inline">\((\Omega,\mathcal{F},P)\)</span> is a finite probability space and <span class="math inline">\(X:\Omega \to \mathbb{R}\)</span> is a random variable, then the <em>expectation</em> of <span class="math inline">\(X\)</span> is defined as</p>
<p><span id="eq-def-expectation"><span class="math display">\[
E(X) \overset{\text{def}}{=}\int_\Omega X \ dP,
\tag{1}\]</span></span></p>
<p>where the integral on the right is the Lebesgue integral with respect to the probability measure <span class="math inline">\(P\)</span>. In the finite setting, this integral reduces to the familiar weighted average of the values of the random variable, where the weights are the probabilities of the level sets of <span class="math inline">\(X\)</span>:</p>

<div class="no-row-height column-margin column-container"><div class="">
<p>The benefit of using the Lebesgue integral (<a href="#eq-def-expectation" class="quarto-xref">1</a>) to define expectation is that it generalizes directly to “continuous” sample spaces equipped with probability measures on <span class="math inline">\(\sigma\)</span>-algebras. In that more general setting, expectation cannot be defined as a simple finite weighted sum as in (<a href="#eq-expectation-finite" class="quarto-xref">2</a>), though it remains a Lebesgue integral. Thus, the Lebesgue integral allows us to treat both discrete and continuous probability theory in a unified manner.</p>
</div></div><p><span id="eq-expectation-finite"><span class="math display">\[
\int_\Omega X \ dP = \sum_{i=1}^m x_i P(A_i),
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(A_1, A_2, \ldots, A_m\)</span> are the level sets of <span class="math inline">\(X\)</span> and <span class="math inline">\(x_i\)</span> is the value of <span class="math inline">\(X\)</span> on <span class="math inline">\(A_i\)</span>. Note that in order for the probability <span class="math inline">\(P(A_i)\)</span> to be defined, we must have <span class="math inline">\(A_i \in \mathcal{F}\)</span>, which is guaranteed if <span class="math inline">\(X\)</span> is <span class="math inline">\(\mathcal{F}\)</span>-measurable.</p>
<p>Finally, two <span class="math inline">\(\mathcal{F}\)</span>-measurable random variables <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> on <span class="math inline">\((\Omega,\mathcal{F},P)\)</span> will be said to be <em>equal almost surely</em> if</p>
<p><span class="math display">\[
P(\{\omega \in \Omega : X(\omega) \neq Y(\omega)\}) = 0.
\]</span></p>
<p>Almost sure equality is an equivalence relation on the set of <span class="math inline">\(\mathcal{F}\)</span>-measurable random variables.</p>
<p>With these ingredients in place, we may now define the <span class="math inline">\(L^2\)</span>-space associated to an algebra of sets on a finite sample space.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-L2" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 4</strong></span> &nbsp;</p>

<p>Let <span class="math inline">\((\Omega,\mathcal{F},P)\)</span> be a finite probability space. We write <span class="math inline">\(L^2(\Omega,\mathcal{F},P)\)</span> for the set of all <span class="math inline">\(\mathcal{F}\)</span>-measurable random variables <span class="math inline">\(X:\Omega \to \mathbb{R}\)</span>, where two random variables are identified if they are equal almost surely. When the set <span class="math inline">\(\Omega\)</span> and the measure <span class="math inline">\(P\)</span> are understood from context, we will abbreviate <span class="math inline">\(L^2(\Omega,\mathcal{F},P)\)</span> as <span class="math inline">\(L^2(\mathcal{F})\)</span>.</p>
</div>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-margin-content callout-margin-content-simple">
<p>The <span class="math inline">\(L^2\)</span> notation is borrowed from the case of a general sample space <span class="math inline">\(\Omega\)</span> equipped with a probability measure <span class="math inline">\(P\)</span> on a <span class="math inline">\(\sigma\)</span>-algebra <span class="math inline">\(\mathcal{F}\)</span>. In that case, <span class="math inline">\(L^2(\Omega,\mathcal{F},P)\)</span> consists of all (equivalence classes of) <span class="math inline">\(\mathcal{F}\)</span>-measurable random variables <span class="math inline">\(X:\Omega \to \mathbb{R}\)</span> such that <span class="math inline">\(E(X^2) &lt; \infty\)</span>. In our finite setting, this condition on the expectation of <span class="math inline">\(X^2\)</span> is automatically satisfied.</p>
</div></div><p>So, technically <span class="math inline">\(L^2(\mathcal{F})\)</span> is a set of equivalence classes of <span class="math inline">\(\mathcal{F}\)</span>-measurable random variables, but for ease of exposition and notation we will often refer to elements of <span class="math inline">\(L^2(\mathcal{F})\)</span> as if they were random variables themselves. This will not cause too much confusion.</p>
<p>One should check that <span class="math inline">\(L^2(\mathcal{F})\)</span> is indeed a vector subspace of the vector space of <em>all</em> random variables on <span class="math inline">\(\Omega\)</span>, which amounts to checking that sums and scalar multiples of <span class="math inline">\(\mathcal{F}\)</span>-measurable random variables are again <span class="math inline">\(\mathcal{F}\)</span>-measurable. We will leave this task to the interested reader.</p>
<p>Beyond inducing equivalence classes under almost sure equality, the probability measure <span class="math inline">\(P\)</span> plays no role in the definition of <span class="math inline">\(L^2(\mathcal{F})\)</span> itself. However, it does define an inner product on this space via expectation:</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-inner-prod" class="theorem">
<p><span class="theorem-title"><strong>Theorem 3 (<span class="math inline">\(L^2\)</span>-spaces are Hilbert spaces)</strong></span> &nbsp;</p>

<p>Let <span class="math inline">\((\Omega,\mathcal{F},P)\)</span> be a finite probability space. The map <span class="math display">\[
\langle -, - \rangle : L^2(\mathcal{F}) \times L^2(\mathcal{F}) \to \mathbb{R}, \quad \langle X, Y \rangle = E(XY)
\]</span> defines an inner product on <span class="math inline">\(L^2(\mathcal{F})\)</span>.</p>
</div>
</div>
</div>
</div>
<div class="no-row-height column-margin column-container"><div class="callout-margin-content callout-margin-content-simple">
<p>A <em>Hilbert space</em> is a complete inner product space. Since <span class="math inline">\(L^2(\mathcal{F})\)</span> is finite-dimensional (see below), it is automatically complete, so the existence of an inner product suffices to make it a Hilbert space.</p>
</div></div><p>Using the Lebesgue integral notation, the inner product can be written as</p>
<p><span id="eq-inner-prod-integral"><span class="math display">\[
\langle X, Y \rangle = \int_\Omega XY \ dP.
\tag{3}\]</span></span></p>
<p>But if we write <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span> as linear combinations of indicator functions,</p>
<p><span class="math display">\[
X = \sum_{i=1}^m x_i I_{A_i} \quad \text{and} \quad Y = \sum_{j=1}^n y_j I_{B_j}
\]</span></p>
<p>where <span class="math inline">\(A_i\)</span> and <span class="math inline">\(B_j\)</span> are the level sets of <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>, respectively, then (<a href="#eq-inner-prod-integral" class="quarto-xref">3</a>) becomes</p>
<p><span class="math display">\[
\langle X, Y \rangle = \sum_{i,j} x_i y_j P(A_i \cap B_j).
\]</span></p>
<p>One should check that <span class="math inline">\(\langle -, -\rangle\)</span> satisfies the properties of an inner product: linearity in the first argument, symmetry, and positive-definiteness. Again, we shall leave this task to the interested reader. We only note that the proof of positive-definiteness involves showing that <span class="math inline">\(\langle X,X\rangle=0\)</span> if and only if <span class="math inline">\(X\)</span> is almost surely equal to the zero random variable. Remember that elements in <span class="math inline">\(L^2(\mathcal{F})\)</span> are equivalence classes under almost sure equality!</p>
<p>The inner product induces a norm</p>
<p><span class="math display">\[
\|X\|_2 = \sqrt{\langle X, X \rangle} = \sqrt{E(X^2)},
\]</span></p>
<p>which measures the “magnitude” of a random variable. This is precisely the so-called <em><span class="math inline">\(L^2\)</span>-norm</em>, and the corresponding metric <span class="math inline">\(d(X, Y) = \|X - Y\|\)</span> measures the mean-squared distance between random variables. In statistics, this is the <em>root mean squared error</em> (<em>RMSE</em>) between <span class="math inline">\(X\)</span> and <span class="math inline">\(Y\)</span>.</p>
<p>When algebras are nested, their corresponding <span class="math inline">\(L^2\)</span>-spaces are nested as well:</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-nested-subspaces" class="theorem">
<p><span class="theorem-title"><strong>Theorem 4</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space. If <span class="math inline">\(\mathcal{G} \subset \mathcal{H}\)</span> are two subalgebras of <span class="math inline">\(\mathcal{F}\)</span>, then <span class="math display">\[
L^2(\mathcal{G}) \subset L^2(\mathcal{H}) \subset L^2(\mathcal{F}).
\]</span></p>
<p>Moreover, these subset inclusions are ones of vector subspaces.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Since <span class="math inline">\(\mathcal{G} \subset \mathcal{H}\)</span>, every <span class="math inline">\(\mathcal{G}\)</span>-measurable random variable is also <span class="math inline">\(\mathcal{H}\)</span>-measurable. Thus, <span class="math inline">\(L^2(\mathcal{G}) \subset L^2(\mathcal{H})\)</span>. A symmetric argument shows that <span class="math inline">\(L^2(\mathcal{H}) \subset L^2(\mathcal{F})\)</span>. The fact that these inclusions are ones of vector subspaces follows from the fact that sums and scalar multiples of measurable random variables are measurable with respect to the same algebra.</p>
</div>
</div>
</div>
<p>This geometric picture connects directly to information refinement: as algebras refine (capturing more information), their <span class="math inline">\(L^2\)</span>-spaces expand in kind (allowing more functions to be represented). Applied to our coin-flip example the nested sequence</p>
<p><span class="math display">\[
\mathcal{F}_1 \subset \mathcal{F}_2 \subset \mathcal{F}_3
\]</span></p>
<p>induces a nested sequence</p>
<p><span class="math display">\[
L^2(\mathcal{F}_1) \subset L^2(\mathcal{F}_2) \subset L^2(\mathcal{F}_3)
\]</span></p>
<p>of <span class="math inline">\(L^2\)</span>-spaces, where each larger subspace represents more refined information about the outcomes.</p>
<p>Finally, we note that the <span class="math inline">\(L^2\)</span>-spaces associated to algebras have particularly simple and useful orthogonal bases, consisting of indicator functions of the atoms of the algebra. Issues arise when atoms have zero probability, but these are easily handled by working with equivalence classes under almost sure equality.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-basis-L2" class="theorem">
<p><span class="theorem-title"><strong>Theorem 5 (Bases of <span class="math inline">\(L^2\)</span>-spaces)</strong></span> Let <span class="math inline">\((\Omega,\mathcal{F},P)\)</span> be a finite probability space, let <span class="math inline">\(\mathcal{G}\)</span> be a subalgebra of <span class="math inline">\(\mathcal{F}\)</span>, and let <span class="math inline">\(B_1, B_2, \ldots, B_m\)</span> be the atoms of <span class="math inline">\(\mathcal{G}\)</span> with positive probability.</p>
<ol type="1">
<li><p>The indicator functions <span class="math inline">\(I_{B_1}, I_{B_2}, \ldots, I_{B_m}\)</span> form an orthogonal basis of <span class="math inline">\(L^2(\mathcal{G})\)</span>.</p></li>
<li><p>The <span class="math inline">\(L^2\)</span>-norm of <span class="math inline">\(I_{B_i}\)</span> is <span class="math inline">\(\sqrt{P(B_i)}\)</span>.</p></li>
<li><p>The vector space dimension of <span class="math inline">\(L^2(\mathcal{G})\)</span> is equal to the number of atoms in <span class="math inline">\(\mathcal{G}\)</span> with positive probability.</p></li>
</ol>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Suppose that we write</p>
<p><span class="math display">\[
B_1,B_2,\ldots,B_m, B_{m+1},B_{m+2},\ldots,B_n,
\]</span></p>
<p>where the sets <span class="math inline">\(B_{m+1},B_{m+2},\ldots,B_n\)</span> are the atoms of <span class="math inline">\(\mathcal{G}\)</span> with zero probability (which may not exist). Let <span class="math inline">\(X\in L^2(\mathcal{G})\)</span> be a random variable. Since <span class="math inline">\(X\)</span> is <span class="math inline">\(\mathcal{G}\)</span>-measurable, it is constant on each atom in <span class="math inline">\(\mathcal{G}\)</span>. Thus, we may write</p>
<p><span class="math display">\[
X = \sum_{i=1}^n x_i I_{B_i},
\]</span></p>
<p>for some values <span class="math inline">\(x_i \in \mathbb{R}\)</span> (not necessarily distinct). However, since <span class="math inline">\(P(B_i) = 0\)</span> for <span class="math inline">\(i = m+1, m+2, \ldots, n\)</span>, we have</p>
<p><span class="math display">\[
X = \sum_{i=1}^m x_i I_{B_i}
\]</span></p>
<p>almost surely. Thus, since elements in <span class="math inline">\(L^2(\mathcal{G})\)</span> are technically equivalence classes under almost sure equality, we have that <span class="math inline">\(X\)</span> is a linear combination of the indicator functions <span class="math inline">\(I_{B_1}, I_{B_2}, \ldots, I_{B_m}\)</span>. Thus, these indicator functions span <span class="math inline">\(L^2(\mathcal{G})\)</span>. To see that they are orthogonal, we suppose <span class="math inline">\(i\neq j\)</span>. Then, <span class="math inline">\(B_i \cap B_j =\emptyset\)</span>, and so</p>
<p><span class="math display">\[
\langle I_{B_i}, I_{B_j} \rangle = E(I_{B_i} I_{B_j}) = E(I_{B_i\cap B_j})= E(0) = 0.
\]</span></p>
<p>Orthogonality implies linear independence, so the proof is complete.</p>
</div>
</div>
</div>
</section>
<section id="conditional-expectations-as-projections" class="level2">
<h2 class="anchored" data-anchor-id="conditional-expectations-as-projections">Conditional expectations as projections</h2>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="def-conditional-expectation" class="theorem definition">
<p><span class="theorem-title"><strong>Definition 5</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space, <span class="math inline">\(\mathcal{G} \subset \mathcal{F}\)</span> a subalgebra, and <span class="math inline">\(X \in L^2(\mathcal{F})\)</span> a random variable. A <em>conditional expectation</em> of <span class="math inline">\(X\)</span> given <span class="math inline">\(\mathcal{G}\)</span> is a random variable <span class="math inline">\(E(X\mid \mathcal{G}) \in L^2(\mathcal{G})\)</span> such that</p>
<p><span id="eq-averaging-property"><span class="math display">\[
\int_B X \ dP = \int_B E(X \mid \mathcal{G}) \ dP.
\tag{4}\]</span></span></p>
<p>for all <span class="math inline">\(B \in \mathcal{G}\)</span>. This is called the <em>averaging property</em> of conditional expectation.</p>
</div>
</div>
</div>
</div>
<p>Any two conditional expectations of <span class="math inline">\(X\)</span> given <span class="math inline">\(\mathcal{G}\)</span> are almost surely equal, so the conditional expectation is unique up to almost sure equality. A particular choice of conditional expectation is called a <em>version</em>.</p>
<p>The averaging property (<a href="#eq-averaging-property" class="quarto-xref">4</a>) defines conditional expectation abstractly, but doesn’t immediately suggest how to compute it. The key insight is that this property has a geometric interpretation. To uncover it, we rewrite the averaging property as</p>
<p><span class="math display">\[
\int_\Omega \left[X - E(X \mid \mathcal{G})\right] I_B \ dP = 0,
\]</span></p>
<p>which, using the inner product from <a href="#thm-inner-prod" class="quarto-xref">Theorem&nbsp;3</a>, becomes</p>
<p><span class="math display">\[
\langle X - E(X \mid \mathcal{G}), I_B \rangle = 0.
\]</span></p>
<p>Since the indicator functions <span class="math inline">\(\{I_B : B \in \mathcal{G}\}\)</span> span <span class="math inline">\(L^2(\mathcal{G})\)</span> (by <a href="#thm-basis-L2" class="quarto-xref">Theorem&nbsp;5</a>), the residual <span class="math inline">\(X - E(X \mid \mathcal{G})\)</span> is orthogonal to every element of <span class="math inline">\(L^2(\mathcal{G})\)</span>. Thus, conditional expectation <span class="math inline">\(E(X\mid \mathcal{G})\)</span> is characterized as the orthogonal projection of <span class="math inline">\(X\)</span> onto the subspace <span class="math inline">\(L^2(\mathcal{G})\)</span>.</p>
<p>Computing this projection is straightforward. Let <span class="math inline">\(B_1,B_2,\ldots,B_m\)</span> be the atoms of <span class="math inline">\(\mathcal{G}\)</span> with positive probability. By <a href="#thm-basis-L2" class="quarto-xref">Theorem&nbsp;5</a>, the normalized indicator functions</p>
<p><span class="math display">\[
\frac{I_{B_1}}{\sqrt{P(B_1)}}, \frac{I_{B_2}}{\sqrt{P(B_2)}}, \ldots, \frac{I_{B_m}}{\sqrt{P(B_m)}}
\]</span></p>
<p>form an orthonormal basis of <span class="math inline">\(L^2(\mathcal{G})\)</span>. The conditional expectation of <span class="math inline">\(X\)</span> given <span class="math inline">\(\mathcal{G}\)</span> is the orthogonal projection onto this basis:</p>
<p><span class="math display">\[
E(X\mid \mathcal{G}) = \sum_{i=1}^m \left\langle X, \frac{I_{B_i}}{\sqrt{P(B_i)}} \right\rangle \frac{I_{B_i}}{\sqrt{P(B_i)}}.
\]</span></p>
<p>Simplifying using the definition of the inner product yields</p>
<p><span id="eq-cond-exp-compute"><span class="math display">\[
E(X\mid \mathcal{G}) = \sum_{i=1}^m \frac{1}{P(B_i)}\left(\int_{B_i} X \ dP \right)I_{B_i}.
\tag{5}\]</span></span></p>
<p>To evaluate the integrals in this formula, we write <span class="math inline">\(X\)</span> in terms of its level sets:</p>
<p><span class="math display">\[
X = \sum_{j=1}^n x_j I_{A_j},
\]</span></p>
<p>where <span class="math inline">\(A_1,A_2,\ldots,A_n\)</span> are the level sets of <span class="math inline">\(X\)</span>. Then</p>
<p><span class="math display">\[
\int_{B_i} X \ dP = \sum_{j=1}^n x_j P(A_j \cap B_i).
\]</span></p>
<p>Substituting into (<a href="#eq-cond-exp-compute" class="quarto-xref">5</a>) gives an explicit formula in terms of conditional probabilities:</p>
<p><span id="eq-cond-exp-compute-2"><span class="math display">\[
E(X\mid \mathcal{G}) = \sum_{i=1}^m \left(\sum_{j=1}^n x_j P(A_j \mid B_i)\right)I_{B_i}
\tag{6}\]</span></span></p>
<p>where <span class="math inline">\(P(A_j \mid B_i) = P(A_j \cap B_i)/P(B_i)\)</span> is the conditional probability of <span class="math inline">\(A_j\)</span> given <span class="math inline">\(B_i\)</span>. This formula connects our geometric framework to the elementary definition of conditional probability.</p>
<p>We summarize this projection interpretation in the following theorem:</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-cond-exp-proj" class="theorem">
<p><span class="theorem-title"><strong>Theorem 6 (Conditional expectation as orthogonal projection)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space, <span class="math inline">\(\mathcal{G} \subset \mathcal{F}\)</span> a subalgebra, and <span class="math inline">\(X \in L^2(\mathcal{F})\)</span> a random variable. Then, the orthogonal projection of <span class="math inline">\(X\)</span> onto the subspace <span class="math inline">\(L^2(\mathcal{G})\)</span> is a conditional expectation of <span class="math inline">\(X\)</span> given <span class="math inline">\(\mathcal{G}\)</span>. This projection is given by <a href="#eq-cond-exp-compute-2" class="quarto-xref">Equation&nbsp;6</a>.</p>
</div>
</div>
</div>
</div>
<p>So, given an <span class="math inline">\(\mathcal{F}\)</span>-measurable random variable <span class="math inline">\(X\)</span> and a coarser algebra <span class="math inline">\(\mathcal{G}\)</span>, we may trivially write</p>
<p><span class="math display">\[
X = E(X\mid \mathcal{G}) + \left[X - E(X \mid \mathcal{G})\right].
\]</span></p>
<p>This decomposition gives us two components: a <span class="math inline">\(\mathcal{G}\)</span>-measurable part <span class="math inline">\(E(X\mid \mathcal{G})\)</span> that captures all information in <span class="math inline">\(X\)</span> knowable from <span class="math inline">\(\mathcal{G}\)</span>, and a residual <span class="math inline">\(X - E(X \mid \mathcal{G})\)</span> orthogonal to every <span class="math inline">\(\mathcal{G}\)</span>-measurable random variable, representing pure noise relative to <span class="math inline">\(\mathcal{G}\)</span>.</p>
<div class="cell" data-layout-align="center">
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set theta (probability of heads for each flip)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>theta <span class="ot">&lt;-</span> <span class="fl">0.6</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Add probability measure: p = theta^Y * (1-theta)^(3-Y)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>Omega <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">p =</span> theta<span class="sc">^</span>Y <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> theta)<span class="sc">^</span>(<span class="dv">3</span> <span class="sc">-</span> Y))</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute E[Y | F1]</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>E_Y_given_F1 <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ai) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">pAi =</span> <span class="fu">sum</span>(p),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_cond =</span> p <span class="sc">/</span> pAi</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">E_Y_given_F1 =</span> <span class="fu">sum</span>(Y <span class="sc">*</span> p_cond))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(E_Y_given_F1, <span class="at">caption =</span> <span class="st">"$E(Y </span><span class="sc">\\</span><span class="st">mid </span><span class="sc">\\</span><span class="st">mathcal{F}_1)$"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption><span class="math inline">\(E(Y \mid \mathcal{F}_1)\)</span></caption>
<thead>
<tr class="header">
<th style="text-align: right;">Ai</th>
<th style="text-align: right;">E_Y_given_F1</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1.2</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">2.2</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute E[Y | F2]</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>E_Y_given_F2 <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Bi) <span class="sc">%&gt;%</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pBi =</span> <span class="fu">sum</span>(p),</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_cond =</span> p <span class="sc">/</span> pBi</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">E_Y_given_F2 =</span> <span class="fu">sum</span>(Y <span class="sc">*</span> p_cond))</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(E_Y_given_F2, <span class="at">caption =</span> <span class="st">"$E(Y </span><span class="sc">\\</span><span class="st">mid </span><span class="sc">\\</span><span class="st">mathcal{F}_2)$"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption><span class="math inline">\(E(Y \mid \mathcal{F}_2)\)</span></caption>
<thead>
<tr class="header">
<th style="text-align: right;">Bi</th>
<th style="text-align: right;">E_Y_given_F2</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1.6</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1.6</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2.6</td>
</tr>
</tbody>
</table>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute E[Y | F3]</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Note: Should equal Y since Y is F3-measurable</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>E_Y_given_F3 <span class="ot">&lt;-</span> Omega <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Ci) <span class="sc">%&gt;%</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">pCi =</span> <span class="fu">sum</span>(p),</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">p_cond =</span> p <span class="sc">/</span> pCi</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">E_Y_given_F3 =</span> <span class="fu">sum</span>(Y <span class="sc">*</span> p_cond))</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(E_Y_given_F3, <span class="at">caption =</span> <span class="st">"$E(Y </span><span class="sc">\\</span><span class="st">mid </span><span class="sc">\\</span><span class="st">mathcal{F}_3)$"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output-display">
<table class="caption-top table table-sm table-striped small">
<caption><span class="math inline">\(E(Y \mid \mathcal{F}_3)\)</span></caption>
<thead>
<tr class="header">
<th style="text-align: right;">Ci</th>
<th style="text-align: right;">E_Y_given_F3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">2</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">3</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">4</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">5</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: right;">6</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td style="text-align: right;">7</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="even">
<td style="text-align: right;">8</td>
<td style="text-align: right;">3</td>
</tr>
</tbody>
</table>
</div>
</div>
<p><br></p>
<p>In the case that <span class="math inline">\(\mathcal{G}= \{\emptyset, \Omega\}\)</span> is the trivial algebra, we have</p>
<p><span class="math display">\[
E(X \mid \mathcal{G}) = E(X),
\]</span></p>
<p>the constant random variable (taking value <span class="math inline">\(E(X)\)</span> everywhere). The trivial algebra represents having no information at all, so the best prediction of <span class="math inline">\(X\)</span> without any information is simply its expectation.</p>
<p>The fact that <span class="math inline">\(E(X \mid \mathcal{G})\)</span> is the “best” <span class="math inline">\(\mathcal{G}\)</span>-measurable approximation to <span class="math inline">\(X\)</span> can be made numerically precise, as in the following theorem:</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-best-approx" class="theorem">
<p><span class="theorem-title"><strong>Theorem 7 (Best <span class="math inline">\(L^2\)</span>-approximation)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space, <span class="math inline">\(\mathcal{G} \subset \mathcal{F}\)</span> a subalgebra, and <span class="math inline">\(X \in L^2(\mathcal{F})\)</span> a random variable. Then,</p>
<p><span class="math display">\[
E\left[(X - E(X \mid \mathcal{G}))^2\right] = \min_{Y \in L^2(\mathcal{G})} E\left[(X - Y)^2\right].
\]</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>This follows directly from the fact that orthogonal projection minimizes distance in inner product spaces. See, for example, Proposition 6.36 in <span class="citation" data-cites="Axler1997">(<a href="#ref-Axler1997" role="doc-biblioref">Axler 1997</a>)</span>.</p>
</div>
</div>
</div>
<p>Beyond optimality, the projection interpretation of conditional expectation immediately yields several other important properties, which we now develop.</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-linearity" class="theorem">
<p><span class="theorem-title"><strong>Theorem 8 (Linearity of conditional expectation)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space, <span class="math inline">\(\mathcal{G} \subset \mathcal{F}\)</span> a subalgebra, and <span class="math inline">\(X, Y \in L^2(\mathcal{F})\)</span> random variables. For any scalars <span class="math inline">\(a,b \in \mathbb{R}\)</span>, we have <span class="math display">\[
E(aX + bY \mid \mathcal{G}) = a E(X \mid \mathcal{G}) + b E(Y \mid \mathcal{G})
\]</span></p>
<p>almost surely.</p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Choose the version of conditional expectation given by orthogonal projection onto <span class="math inline">\(L^2(\mathcal{G})\)</span> as in <a href="#thm-cond-exp-proj" class="quarto-xref">Theorem&nbsp;6</a>. Since orthogonal projection is linear, the desired result follows immediately.</p>
</div>
</div>
</div>
<p>Linearity tells us that conditional expectation behaves well under linear combinations. But what happens when we condition on the product <span class="math inline">\(XY\)</span> of two random variables? If <span class="math inline">\(Y\)</span> is already <span class="math inline">\(\mathcal{G}\)</span>-measurable, then <span class="math inline">\(Y\)</span> is “known” given the information in <span class="math inline">\(\mathcal{G}\)</span>, so it should factor out of the conditional expectation. This intuition is formalized by the following property:</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-pull-out" class="theorem">
<p><span class="theorem-title"><strong>Theorem 9 (Pull-out property)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space, <span class="math inline">\(\mathcal{G} \subset \mathcal{F}\)</span> a subalgebra, and <span class="math inline">\(X \in L^2(\mathcal{F})\)</span> a random variable. If <span class="math inline">\(Y\)</span> is a <span class="math inline">\(\mathcal{G}\)</span>-measurable random variable,</p>
<p><span class="math display">\[
E(XY \mid \mathcal{G}) = Y E(X \mid \mathcal{G}).
\]</span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We will prove that the random variable <span class="math inline">\(Y E(X \mid \mathcal{G})\)</span> has the defining property of a conditional expectation of <span class="math inline">\(XY\)</span> given <span class="math inline">\(\mathcal{G}\)</span>. To this end, we let <span class="math inline">\(B\)</span> be a set in <span class="math inline">\(\mathcal{G}\)</span>. Then <span class="math inline">\(YI_B\)</span> is <span class="math inline">\(\mathcal{G}\)</span>-measurable, so that if we choose the version of <span class="math inline">\(E(X\mid \mathcal{G})\)</span> given by orthogonal projection onto <span class="math inline">\(L^2(\mathcal{G})\)</span> as in <a href="#thm-cond-exp-proj" class="quarto-xref">Theorem&nbsp;6</a>, we must have</p>
<p><span class="math display">\[
\langle X - E(X \mid \mathcal{G}), Y I_B \rangle = 0.
\]</span></p>
<p>However, this inner product is</p>
<p><span class="math display">\[
\langle X - E(X \mid \mathcal{G}), Y I_B \rangle = \int_B \left[XY - Y E(X \mid \mathcal{G})\right] \ dP,
\]</span></p>
<p>so we get</p>
<p><span class="math display">\[
\int_B XY \ dP = \int_B Y E(X \mid \mathcal{G}) \ dP.
\]</span></p>
<p>This completes the proof.</p>
</div>
</div>
</div>
<p>The pull-out property shows that <span class="math inline">\(\mathcal{G}\)</span>-measurable factors can be extracted from conditional expectations. But what happens when we have a nested sequence of algebras <span class="math inline">\(\mathcal{G} \subset \mathcal{H} \subset \mathcal{F}\)</span>, representing increasingly refined information states?</p>
<p>Intuitively, if we first condition on the finer information <span class="math inline">\(\mathcal{H}\)</span> and then “forget” some information by conditioning on the coarser <span class="math inline">\(\mathcal{G}\)</span>, we should get the same result as conditioning directly on <span class="math inline">\(\mathcal{G}\)</span>. This is the content of the following property (also called the <em>law of iterated expectations</em>):</p>
<div class="callout callout-style-simple callout-tip no-icon">
<div class="callout-body d-flex">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-body-container">
<div id="thm-tower" class="theorem">
<p><span class="theorem-title"><strong>Theorem 10 (Tower property)</strong></span> Let <span class="math inline">\((\Omega, \mathcal{F}, P)\)</span> be a finite probability space, and let <span class="math inline">\(\mathcal{G} \subset \mathcal{H} \subset \mathcal{F}\)</span> be subalgebras. If <span class="math inline">\(X \in L^2(\mathcal{F})\)</span> is a random variable, then</p>
<p><span id="eq-tower"><span class="math display">\[
E(E(X \mid \mathcal{H}) \mid \mathcal{G}) = E(X \mid \mathcal{G}).
\tag{7}\]</span></span></p>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Proof.
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>We have the inclusion of vector subspaces</p>
<p><span class="math display">\[
L^2(\mathcal{G}) \subset L^2(\mathcal{H}) \subset L^2(\mathcal{F}).
\]</span></p>
<p>If we choose the versions of the conditional expectations given by orthogonal projection as in <a href="#thm-cond-exp-proj" class="quarto-xref">Theorem&nbsp;6</a>, then the left-hand side of (<a href="#eq-tower" class="quarto-xref">7</a>) is the orthogonal projection of <span class="math inline">\(X\)</span> onto <span class="math inline">\(L^2(\mathcal{H})\)</span> followed by the orthogonal projection onto <span class="math inline">\(L^2(\mathcal{G})\)</span>. However, since the subspaces are nested, this composition is simply the orthogonal projection of <span class="math inline">\(X\)</span> onto <span class="math inline">\(L^2(\mathcal{G})\)</span>, which is the right-hand side of the desired equation.</p>
</div>
</div>
</div>
<p>We now apply these abstract results to our running example of three coin flips. This will make the geometric picture concrete and show how conditional expectations improve predictions as information refines.</p>
<p>Recall our nested sequence of algebras: <span class="math display">\[
\mathcal{F}_1 = \sigma(X_1) \subset \mathcal{F}_2 = \sigma(X_1, X_2) \subset \mathcal{F}_3 = \sigma(X_1, X_2, X_3),
\]</span> where <span class="math inline">\(\mathcal{F}_1\)</span> has 2 atoms, <span class="math inline">\(\mathcal{F}_2\)</span> has 4 atoms, and <span class="math inline">\(\mathcal{F}_3\)</span> has 8 atoms. We’ll compute conditional expectations of <span class="math inline">\(Y = X_1 + X_2 + X_3\)</span> (total number of heads) given each algebra.</p>
<p><strong>Predicting with no information: <span class="math inline">\(E(Y)\)</span></strong></p>
<p>With no information about any flips, the best prediction is the unconditional expectation: <span class="math display">\[
E(Y) = 0 \cdot P(Y=0) + 1 \cdot P(Y=1) + 2 \cdot P(Y=2) + 3 \cdot P(Y=3)
\]</span></p>
<p>This is a constant function on <span class="math inline">\(\Omega\)</span>—the same prediction for all outcomes.</p>
<p><strong>Predicting after the first flip: <span class="math inline">\(E(Y \mid \mathcal{F}_1)\)</span></strong></p>
<p>By <a href="#thm-basis-L2" class="quarto-xref">Theorem&nbsp;5</a>, <span class="math inline">\(E(Y \mid \mathcal{F}_1)\)</span> must be constant on each atom of <span class="math inline">\(\mathcal{F}_1\)</span>. The atoms are: - <span class="math inline">\(A_1 = \{000, 001, 010, 011\}\)</span> (first flip is 0) - <span class="math inline">\(A_2 = \{100, 101, 110, 111\}\)</span> (first flip is 1)</p>
<p>By the averaging property, on <span class="math inline">\(A_1\)</span>: <span class="math display">\[
E(Y \mid \mathcal{F}_1)|_{A_1} = \frac{\int_{A_1} Y \, dP}{P(A_1)} = E(Y \mid X_1 = 0) = 0 + E(X_2) + E(X_3) = 2\theta
\]</span></p>
<p>Similarly, on <span class="math inline">\(A_2\)</span>: <span class="math display">\[
E(Y \mid \mathcal{F}_1)|_{A_2} = E(Y \mid X_1 = 1) = 1 + E(X_2) + E(X_3) = 1 + 2\theta
\]</span></p>
<p>Thus: <span class="math display">\[
E(Y \mid \mathcal{F}_1) = 2\theta \cdot I_{A_1} + (1 + 2\theta) \cdot I_{A_2}
\]</span></p>
<p>This shows how the prediction updates based on the first flip: if <span class="math inline">\(X_1 = 0\)</span>, we predict <span class="math inline">\(2\theta\)</span> more heads; if <span class="math inline">\(X_1 = 1\)</span>, we predict <span class="math inline">\(1 + 2\theta\)</span> total heads.</p>
<p><strong>The tower property in action</strong></p>
<p>We can verify the tower property by computing: <span class="math display">\[
E(E(Y \mid \mathcal{F}_2) \mid \mathcal{F}_1)
\]</span></p>
<p>By <a href="#thm-tower" class="quarto-xref">Theorem&nbsp;10</a>, this should equal <span class="math inline">\(E(Y \mid \mathcal{F}_1)\)</span>. We’ll verify this computationally in the code below.</p>
<p>[Add R code computing these conditional expectations and showing the tower property]</p>
</section>
<section id="conclusion" class="level2">
<h2 class="anchored" data-anchor-id="conclusion">Conclusion</h2>
</section>
<section id="bibliography" class="level2">




</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">Bibliography</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Axler1997" class="csl-entry" role="listitem">
Axler, S. 1997. <em>Linera Algebra Done Right</em>. Second. Undergraduate Texts in Mathematics. Springer.
</div>
<div id="ref-Kallenberg2021" class="csl-entry" role="listitem">
Kallenberg, O. 2021. <em>Foundations of Modern Probability</em>. Third. Vol. 99. Probability Theory and Stochastic Modelling. Springer.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/johnmyers-phd\.com");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>